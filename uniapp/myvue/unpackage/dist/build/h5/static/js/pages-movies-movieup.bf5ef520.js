(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-movies-movieup"],{"3bd3":function(t,i,e){"use strict";var n=e("288e");Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0,e("7f7f");var s=n(e("59ad")),a={data:function(){return{user:null,types:["搞笑","武侠","爱情","科幻"],typesindex:-1,imgList:[],video:null,size:null,name:null,title:null,uping:!1,url:null,image:null,time:null}},onLoad:function(){this.islogin()},methods:{islogin:function(){var t=this;uni.getStorage({key:"user",success:function(i){t.user=i.data,null==t.user&&uni.showModal({title:"提示",content:"当前未登录请登录后再试！",cancelText:"不了",confirmText:"去登陆",success:function(t){t.confirm?uni.navigateTo({url:"../login/login"}):t.cancel&&uni.switchTab({url:"../movies/movies"})}})}})},getname:function(t){this.name=t.detail.value},getitle:function(t){this.title=t.detail.value},videoAdd:function(){var t=this;uni.chooseVideo({count:1,sourceType:["camera","album"],success:function(i){t.video=i.tempFilePath,t.size=(0,s.default)(i.size/1048576).toFixed(2)}})},ok:function(){var t=this;if(t.name&&t.title&&-1!=t.typesindex&&0!=t.imgList.length&&t.video){t.uping=!0;for(var i=t.imgList.concat(t.video),e=function(e){uni.uploadFile({url:getApp().globalData.zuul+"movies/movie/uploadVideo",header:{key:t.user.username,value:t.user.sessionid},filePath:i[e],name:"multipartFile",success:function(i){t.uping=!1;var n=JSON.parse(i.data);n.status?0==e?t.image=n.data:(t.url=n.data.path,t.time=n.data.time,null==t.url||null==t.time||null==t.image?uni.showToast({icon:"none",title:"文件信息有误！",duration:"2000"}):t.addmv()):uni.showModal({title:"提示",content:n.msg,success:function(t){t.confirm||t.cancel}})}})},n=0;n<=i.length;n++)e(n)}else uni.showModal({title:"提示",content:"信息不完整！请检查后再上传！",success:function(t){t.confirm||t.cancel}})},addmv:function(){uni.request({url:getApp().globalData.zuul+"movies/movie/addmovie",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",key:this.user.username,value:this.user.sessionid},data:this.$qs.stringify({name:this.name,url:this.url,image:this.image,userid:this.user.id,username:this.user.loginname,type:this.types[this.typesindex],time:this.time,title:this.title}),success:function(t){t.data.status?(uni.showToast({title:"保存成功！",duration:3e3,icon:"none"}),uni.redirectTo({url:"movieup"})):uni.showModal({title:"提示",content:"保存视频信息失败了！",success:function(t){t.confirm||t.cancel}})},fail:function(t){uni.showToast({title:"服务器出错啦！",duration:2e3,icon:"none"})}})},PickerChange:function(t){this.typesindex=t.detail.value},ViewImage:function(t){uni.previewImage({urls:this.imgList,current:t.currentTarget.dataset.url})},DelImg:function(t){var i=this;uni.showModal({title:"提示",content:"确定要删除这个封面吗？",cancelText:"再想想",confirmText:"还是换张吧",success:function(e){e.confirm&&i.imgList.splice(t.currentTarget.dataset.index,1)}})},ChooseImage:function(){var t=this;uni.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(i){0!=t.imgList.length?t.imgList=t.imgList.concat(i.tempFilePaths):t.imgList=i.tempFilePaths}})}}};i.default=a},"94f9":function(t,i,e){"use strict";var n=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("v-uni-view",[e("v-uni-view",{staticClass:"cu-form-group "},[e("v-uni-view",{staticClass:"title"},[t._v("视频标题")]),e("v-uni-input",{attrs:{placeholder:"标题(不超过十个字符)",name:"input",maxlength:"10"},on:{input:function(i){i=t.$handleEvent(i),t.getname(i)}}})],1),e("v-uni-view",{staticClass:"cu-form-group margin-top"},[e("v-uni-view",{staticClass:"title"},[t._v("视频分类")]),e("v-uni-picker",{attrs:{value:t.typesindex,range:t.types},on:{change:function(i){i=t.$handleEvent(i),t.PickerChange(i)}}},[e("v-uni-view",{staticClass:"picker"},[t._v(t._s(t.typesindex>-1?t.types[t.typesindex]:"点击选择视频分类"))])],1)],1),e("v-uni-view",{staticClass:"cu-form-group align-start"},[e("v-uni-view",{staticClass:"title"},[t._v("视频简介")]),e("v-uni-textarea",{attrs:{maxlength:"100",placeholder:"写点什么吧!"},on:{input:function(i){i=t.$handleEvent(i),t.getitle(i)}}})],1),e("v-uni-view",{staticClass:"cu-bar bg-white margin-top"},[e("v-uni-view",{staticClass:"action"},[t._v("选择封面(jpg/jpeg格式不能大于1MB)")]),e("v-uni-view",{staticClass:"action"},[t._v(t._s(t.imgList.length)+"/1")])],1),e("v-uni-view",{staticClass:"cu-form-group"},[e("v-uni-view",{staticClass:"grid col-4 grid-square flex-sub"},[t._l(t.imgList,function(i,n){return e("v-uni-view",{key:n,staticClass:"bg-img",attrs:{"data-url":t.imgList[n]},on:{click:function(i){i=t.$handleEvent(i),t.ViewImage(i)}}},[e("v-uni-image",{attrs:{src:t.imgList[n],mode:"aspectFill"}}),e("v-uni-view",{staticClass:"cu-tag bg-red",attrs:{"data-index":n},on:{click:function(i){i.stopPropagation(),i=t.$handleEvent(i),t.DelImg(i)}}},[e("v-uni-text",{staticClass:"cuIcon-close"})],1)],1)}),t.imgList.length<1?e("v-uni-view",{staticClass:"solids",on:{click:function(i){i=t.$handleEvent(i),t.ChooseImage(i)}}},[e("v-uni-text",{staticClass:"cuIcon-cameraadd"})],1):t._e()],2)],1),e("v-uni-view",{staticClass:"cu-form-group margin-top",on:{click:function(i){i=t.$handleEvent(i),t.videoAdd(i)}}},[e("v-uni-view",{staticClass:"title"},[t._v("上传文件(mp4格式不能大于1MB)")]),e("v-uni-view",{staticClass:"picker"},[e("v-uni-text",[t._v(t._s(null==t.video?"选择视频文件 >":"文件大小:"+t.size+"MB"))])],1)],1),e("v-uni-view",{staticClass:"padding-xl"},[e("v-uni-button",{staticClass:"cu-btn block bg-blue margin-tb-sm lg",on:{click:function(i){i=t.$handleEvent(i),t.ok(i)}}},[e("v-uni-text",{directives:[{name:"show",rawName:"v-show",value:t.uping,expression:"uping"}],staticClass:"cuIcon-loading2 cuIconfont-spin"}),t._v("确认上传")],1)],1)],1)},s=[];e.d(i,"a",function(){return n}),e.d(i,"b",function(){return s})},a870:function(t,i,e){"use strict";e.r(i);var n=e("3bd3"),s=e.n(n);for(var a in n)"default"!==a&&function(t){e.d(i,t,function(){return n[t]})}(a);i["default"]=s.a},b09b:function(t,i,e){"use strict";e.r(i);var n=e("94f9"),s=e("a870");for(var a in s)"default"!==a&&function(t){e.d(i,t,function(){return s[t]})}(a);var u=e("2877"),o=Object(u["a"])(s["default"],n["a"],n["b"],!1,null,"7196562a",null);i["default"]=o.exports}}]);